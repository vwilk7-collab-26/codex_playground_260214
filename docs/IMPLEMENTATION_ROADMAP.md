# 구현 로드맵 v1 (사양서 기반)

기준 문서: `docs/QUANT_TOOL_FOUNDATION.md`
목표: 전체를 한 번에 만들지 않고, 블록 단위로 구현/검증하며 확장한다.

## 0) 구현 원칙
1. 블록 단위 완료 후 다음 블록으로 이동한다.
2. 각 블록은 "완료 조건(DoD)"을 충족해야 완료로 본다.
3. 공용 인터페이스를 먼저 고정하고 구현체를 붙인다.
4. 성능 최적화는 측정 기반으로만 진행한다.
5. 무료 사용 원칙을 유지한다.
6. 로드맵은 레이어 분해보다 수직 슬라이스(엔드투엔드 데모 가능) 단위로 실행한다.

---

## 0.1) 기능 개발시 주의 사항 (추가 확정)
1. 프로젝트 스캐폴딩을 먼저 만들고, 실행/테스트 명령을 통일한다.
   - 예: `make run`, `make test`, `make lint`, `make format`
2. 린터/포매터를 기본 설정하고 실행 스크립트를 제공한다.
   - 최소: `ruff`(lint+format) 또는 동등 도구
3. 기능 블록은 수직 슬라이스로 자른다.
   - 각 슬라이스는 UI -> 서비스 -> 저장/출력까지 최소 데모가 가능해야 한다.
4. 기능 블록마다 전용 브랜치에서 작업한다.
   - 브랜치 규칙: `codex/<feature-name>`
   - 최소 테스트 1개 이상을 먼저 추가하고, lint/test 자동 검증을 실행한다.
   - 실패 시 원인 로그를 남기고(에러 요약 + 재현 명령), 자동 수정 가능한 항목은 우선 수정한다.
5. PR 설명에는 아래 3가지를 반드시 포함한다.
   - 변경내용
   - 테스트 방법
   - 스크린샷(UI 변경 시)
6. 기능 단위 완료 후 메인 병합 직전/직후 테스트를 모두 수행한다.
   - 병합 후 이슈가 생기면 즉시 수정 커밋으로 복구한다.
7. 기능 완료 체크리스트를 매번 적용한다.
   - 입력 검증: 빈 값/범위/형식
   - 실패 케이스: 네트워크/권한/없는 데이터
   - UI 상태: 로딩/빈 상태
   - 로깅: 최소 에러 로그
   - 테스트: 최소 1개
   - 문서: README 및 관련 문서 변경점 반영

---

## 1) 블록 구조 (의존성 순서)

### Block A: 프로젝트 저장/복원 코어
목표:
- 프로젝트 생성, 제목/생성시점 저장, 상태 복원

핵심 작업:
- `Project`, `Run`, `StrategySpec` 스키마 설계
- SQLite 저장소(`projects.repository`) 구현
- 상단 `저장` 액션과 로드 액션 인터페이스 정의

완료 조건(DoD):
- 프로젝트 생성 -> 앱 재시작 -> 동일 상태 복원 성공
- 다중 프로젝트 목록/상세 조회 가능

---

### Block B: 심볼 추천/선택
목표:
- 이름 입력 시 상위 500 코인 기준 1~3개 추천 + 이미지 표시

핵심 작업:
- `search_symbols(query, limit=3, rank_max=500)` 구현
- 한국어/영어 검색어 정규화
- no-match 안내 처리
- 다중 선택 상태 관리

완료 조건(DoD):
- 검색어 입력 시 추천 1~3개 노출
- 티커는 영어만 입력 허용
- 다중 심볼 선택 결과가 프로젝트 상태에 저장됨

---

### Block C: 기간/타임프레임 선택
목표:
- 30일 단위 타임라인 클릭 + 수동 입력 동시 지원

핵심 작업:
- 30일 블록 시각화 컴포넌트
- 시작/종료 범위 선택 로직
- 데이터 가용 시작일 자동 보정 로직

완료 조건(DoD):
- 타임라인 클릭/수동 입력 모두 동작
- 너무 이른 시작일 입력 시 자동 보정 및 안내

---

### Block D: 자연어 전략 해석 에이전트
목표:
- 자연어 전략을 구조화하고 누락 조건을 보완 질의

핵심 작업:
- 전략 DSL(JSON/YAML) 스키마 고정
- 입력(한/영) -> 전략 요약 생성
- 누락 항목 체크리스트(진입/청산/손절/수수료/슬리피지)
- 사용자 확인 후 스펙 확정

완료 조건(DoD):
- 자연어 입력 시 전략 요약과 누락 항목 제안 출력
- 사용자 수정 후 스펙 확정 저장 가능

---

### Block E: 차트 시각 검증
목표:
- 오른쪽 패널에서 차트/지표/매수매도 포인트 표시 후 OK 확인

핵심 작업:
- 캔들 + 지표 오버레이 렌더링
- 매수/매도 포인트 마커 및 범례/색상 적용
- `OK` 게이트(확인 전 백테스트 실행 불가)

완료 조건(DoD):
- 전략 적용 위치가 차트에 명확히 보임
- 사용자가 OK 클릭해야 백테스트 버튼 활성화

---

### Block F: 백테스트 엔진 MVP
목표:
- 기본 성과지표 계산(ROI/MDD/승률/손익분포) 및 반복 실행

핵심 작업:
- 시그널 -> 주문 -> 체결 흐름 구현
- 수수료/고정 슬리피지/다음 봉 체결 반영
- 실행 이력(run history) 누적

완료 조건(DoD):
- 동일 입력에서 결과 재현
- 설정값 변경 후 재실행 시 run 이력 비교 가능

---

### Block G: 결과 화면/프로젝트 간 비교
목표:
- 프로젝트 내부 결과 비교 + 프로젝트 간 전략 비교

핵심 작업:
- 자산/타임프레임/전략별 비교 테이블
- 색상 규칙: 수익 Red, 손실 Blue
- 다중 프로젝트 선택 비교 뷰

완료 조건(DoD):
- 같은 프로젝트 내 run 비교 가능
- 여러 프로젝트 비교 리포트 화면 확인 가능

---

### Block H: 선택적 문서화(Excel/PDF)
목표:
- 문서화 버튼 클릭 시에만 한글 리포트 생성

핵심 작업:
- Excel/PDF 템플릿 정의
- 차트/범례/색상 포함
- 한국어 설명 자동 채우기

완료 조건(DoD):
- 문서화 버튼 클릭 시 파일 생성
- 리포트에 전략 요약, 핵심 지표, 차트 시각화 포함

---

## 2) 복잡성/리팩토링 가드레일
1. 엔진/전략/데이터 공급자 인터페이스를 분리해 결합도를 낮춘다.
2. UI는 오케스트레이션만 하고 비즈니스 로직은 서비스 계층에 둔다.
3. 공통 계산(지표, 성과지표)은 단일 모듈로 유지한다.
4. 데이터 공급자 교체는 어댑터 추가로 해결하고 기존 코드 수정은 최소화한다.

---

## 3) 성능 가드레일 (초기)
1. 캐시: 심볼 메타/상위 500 목록은 TTL 캐시 적용
2. 저장: 시계열은 배치 조회, 불필요한 전량 로딩 금지
3. 계산: 반복 백테스트 시 변경 없는 구간은 재사용 고려
4. 측정: 블록별 실행 시간 로그를 남겨 병목 지점부터 최적화

---

## 4) 첫 구현 스프린트 제안 (2주)
1주차:
- Block A 완료
- Block B 완료
- Block C 완료

2주차:
- Block D 완료
- Block E 완료
- Block F의 최소 버전 완료

스프린트 종료 기준:
- 프로젝트 생성 -> 심볼/기간 선택 -> 전략 해석 -> 차트 확인 OK -> 백테스트 1회 -> 저장/재열기까지 한 흐름이 동작

---

## 5) 다음 액션
1. 저장 스키마(SQLite) 상세 설계 문서 작성
2. 전략 DSL(JSON/YAML) 초안 작성
3. UI 프레임워크 확정(현재 후보: Streamlit vs FastAPI+React)
4. 공통 개발 명령(`make`)과 lint/test 파이프라인 초기 스캐폴딩 작성
